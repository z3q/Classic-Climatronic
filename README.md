### **Терморегулятор для старых автомобилей**

Это программа для **терморегулятора** на микроконтроллере **MSP430G2452**, управляющего нагревателем через **ПИД-регулятор** с обратной связью от датчика температуры **DS18B20**.  

---

### **Основные функции:**
1. **Управление нагревом**:
   - Чтение температуры с датчика **DS18B20** (раз в 30 сек).
   - Управление ШИМ (частота **47 Гц**) для нагревателя через **P1.2** (TA0.1).
   - Полное отключение (0%) или включение (100%) при выходе за границы "мёртвой зоны" АЦП (100–923).

2. **ПИД-регулятор**:
   - **Пропорциональная (P)**, **интегральная (I)** и **дифференциальная (D)** составляющие.
   - Коэффициенты:
     - `KP = 2.0`, `KI = 0.0003`, `KD = 5.0` (в формате Q8.8/Q16.16).
   - Ограничение интегральной суммы для защиты от "разгона".

3. **Уставка температуры**:
   - Задаётся через АЦП (**P1.4**, канал A4) в диапазоне **16.0–25.375°C**.
   - При изменении уставки на **>100 отсчётов** значение выводится на дисплей.

4. **Отображение данных**:
   - На **4-разрядном дисплее TM1637**:
     - Температура (в °C).
     - Текущий ШИМ (в HEX).
     - Ошибкиа датчика ("Er").

5. **Отладка через UART (опционально)**:
   - При раскомментированном `#define DEBUG_PID`:
     - Вывод **CSV-данных** (Error, P, I, D, Output, PWM) через **софтовый UART** (пин P1.1).
     - В релизе можно закомментировать для экономии памяти.

---

### **Особенности:**
- **Высокая инерционность** системы (время реакции ~5 мин) учтена в настройках ПИД.
- **Фильтрация шумов**: интегрирование ошибки и защита от переполнения.
- **Энергоэффективность**: микроконтроллер большую часть времени в **LPM3** (режим пониженного потребления).

### **Пример работы:**
1. Пользователь крутит потенциометр → меняется `adcValue` → корректируется `setpoint`.
2. ПИД-регулятор вычисляет ошибку (`setpoint - temperature`) и управляет ШИМ.
3. При ошибке датчика (например, обрыв) ШИМ переходит в ручной режим (`adcValue >> 2`).

### **Итог:**
Код реализует **точный терморегулятор** с защитой от ошибок, возможностью отладки и оптимизацией для энергосбережения. Для финальной версии можно отключить UART, закомментировав `DEBUG_PID`.