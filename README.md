### **Терморегулятор для старых автомобилей и не только**

Программа для **терморегулятора** на микроконтроллере **MSP430G2452**, управляющего термоклапаном или нагревателем через **ПИД-регулятор** с обратной связью от датчика температуры **DS18B20**.

---

### **Основные функции**
1. **Управление нагревом**:
   - Чтение температуры с датчика **DS18B20** (раз в 30 сек, без контрольной суммы, с проверкой диапазона значений -55..+80°C).
   - Управление ШИМ (частота **47 Гц**) для нагревателя через **P1.2** (TA0.1).
   - Полное отключение (0%) или включение (100%) при выходе за границы "рабочей зоны" АЦП (250–815).

2. **ПИД-регулятор**:
   - **Пропорциональная (P)**, **интегральная (I)** и **дифференциальная (D)** составляющие.
   - Ограничение интегральной суммы для защиты от "разгона".

3. **Уставка температуры**:
   - Задаётся через АЦП (**P1.4**, канал A4) в диапазоне **16.0–25.375°C**.
   - При изменении уставки на **>40 отсчётов** (примерно 0,5°C) значение выводится на дисплей.

4. **Отображение данных**:
   - На **4-разрядном дисплее TM1637**:
     - Уставка (в °C);
     - Температура (в °C) или ошибкиа датчика ("Er") - кратковременно;
     - Текущий КЗИ ШИМ (в палочках и точке одного разряда).

5. **Отладка через UART (опционально)**:
   - При раскомментированном `#define DEBUG_PID`:
     - Вывод **CSV-данных** (Error, P, I, D, Output, PWM) через **софтовый UART** (пин P1.1).
     - В релизе можно закомментировать для экономии памяти.

---

### **Особенности**
- **Высокая инерционность** системы (время реакции ~5 мин) учтена в настройках ПИД.
- **Фильтрация шумов**: интегрирование ошибки, защита от переполнения, экспоненциальный фильтр дифференциальной составляющей.
- **Энергоэффективность**: микроконтроллер большую часть времени в **LPM3** (режим пониженного потребления).

### **Пример работы**
1. Пользователь крутит потенциометр → меняется `adcValue` → корректируется `setpoint`.
2. ПИД-регулятор вычисляет ошибку (`setpoint - temperature`) и управляет ШИМ.
3. При ошибке датчика (например, обрыв) ШИМ переходит в ручной режим (`adcValue >> 2`, т.е. `(0..1023) => (0..255)`).

### **Итог**
Код реализует **точный терморегулятор** с защитой от ошибок, возможностью отладки и оптимизацией для энергосбережения. Для финальной версии можно отключить UART, закомментировав `DEBUG_PID`.

---

### **Зависимости**
[Arduino Library for the TM1637 Based LED Display Module](https://jasonacox.github.io/TM1637TinyDisplay/)

### **Лицензия**
GNU GPL v3